# ADR 004: LGTM Stack for Telemetry and Tracing

## Status
Accepted

## Context
In a distributed system involving async messaging (RabbitMQ) and hardware mocks, debugging "what happened" is difficult. We need to trace a request from the React Client, through the API, into the Message Queue, and finally to the Hardware Mock. We also need to correlate logs with these traces.

## Decision
We will use the **LGTM Stack** (Loki, Grafana, Tempo, Mimir) instrumented via **OpenTelemetry**.

* **Logs (Loki):** Centralized logging for all containers.
* **Traces (Tempo):** Distributed tracing to visualize the lifespan of a user entry request across boundaries (API -> RabbitMQ -> Mock).
* **Metrics (Mimir/Prometheus):** Tracking system health (queue depth, API latency).
* **Visualization (Grafana):** Unified dashboard.

## Consequences
* **Positive:** Best-in-class correlation between logs and traces. We can see the specific log error associated with a slow trace span.
* **Positive:** OpenTelemetry is vendor-agnostic; if we move to a cloud provider (Azure Monitor, AWS X-Ray) later, the code instrumentation does not change.
* **Negative:** The stack is resource-intensive to run locally compared to simple console logging.